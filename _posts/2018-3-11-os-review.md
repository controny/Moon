---
layout: post
title:  "操作系统相关问题"
tag:
- 操作系统
comments: true
---

## 进程与线程的区别

- 进程是操作系统进行**资源分配**的基本单位。线程则是**CPU调度**的最小单位，一个进程可以包含多个线程。
- 进程拥有独立的地址空间，同一个进程下的线程共享该进程的内存资源空间。因此线程的创建、切换比进程的相关操作快速许多，代价也少许多。
- 线程间的通信比较方便，可通过共享的数据（如全局变量、静态变量、打开的文件、子进程等）进行通信。
- 多进程程序比多线程程序健壮：一个线程崩溃了，其所在的进程就崩溃了，同一进程下的其他线程自然也随着崩溃；而一个进程的阻塞则不影响其他进程。
- 进程间可以有父子关系，而线程之间只能是平等的。

## 多进程与多线程的选择
对于需要频繁对同一个对象进行不同处理的，选择多线程合适；对于一些并发编程，不需要很多数据交互的，采用多进程。

## 进程间通信的方式

- 管道
其实质可以看成是一个内核缓冲队列，进程以先进先出（FIFO）的方式从缓冲区存取数据。
![](https://controny.github.io/assets/images/posts/20180310163412.png)
- 信号
信号是软件层次上对中断机制的一种模拟，是一种异步通信方式，它可以在任何时候发给某一进程，而无需知道该进程的状态：如果该进程尚未执行，则该信号被内核保存，直到该进程恢复执行时才传递给它。
- 消息队列
消息队列是消息的链表，具有特定的格式，存放在内存中并由消息队列标识符表示，允许一个或多个进程向它写入与读取消息。
- 共享内存
使多个进程直接读写同一块内存，是最快的进程间通信方式。由于多个进程共享一段内存，因此需要依靠某种同步机制（如信号量）来达到进程间的同步及互斥。
- 信号量（semaphore）
信号量是一个计数器，用于控制多进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。  
对信号量的操作主要有两种：`wait(semap)`：测试这个信号量的值，如果小于0，就阻塞，也称为P操作；`signal(semap)`：将信号量的值加1，也称为V操作。
信号量与互斥量之间的区别有：
    - 互斥量用于控制进程间的**互斥**，信号量用于控制进程间的**同步**（同步是指在互斥的基础上，通过其它机制实现访问者对资源的有序访问）。
    - 互斥量的值只能是0或1，信号量的值可以是任何非负整数。
    - 互斥量的加锁和解锁必须由同一个进程完成，而信号量可以由一个进程释放，另一个进程得到。
- 套接字（socket）
套接字可以让不在同一台计算机但通过网络连接计算机上的进程进行通信。套接字是支持TCP/IP的网络通信的基本操作单元，可以看做是不同主机之间的进程进行双向通信的端点，简单的说就是通信的两方的一种约定，用套接字中的相关函数来完成通信过程。
![](https://controny.github.io/assets/images/posts/20180310170650.png)

## 死锁的四个条件
1. 互斥。一个资源不可以同时被多个进程访问。
2. 占有和等待。进程占有一定的资源，同时等待被其他进程占用的资源。
3. 不可抢占。资源只能被占有它的进程自愿释放，而不能通过调度的方式抢占它。
4. 环路等待。多个进程和资源形成环路。
![](https://controny.github.io/assets/images/posts/20180311104346.png)

## 页面置换算法
- 最佳（Optimal）
所选择的被换出的页面将是最长时间内不再被访问，通常可以保证获得最低的缺页率。然而是一种理论上的算法，因为无法知道一个页面多长时间会被再访问到。
- 先进先出（FIFO）
- 最近最少使用（LRU，Least Recently Used）
可使用链表实现，原理如下图：
![](https://controny.github.io/assets/images/posts/20180311105949.png)
	1. 如果要访问的页号在链表中不存在，则插入到头部。
	2. 否则把该页号移至头部。
	3. 链表尾部元素代表的是最近最少使用的页号，当需要置换出页面时，就选择把该页面移除。
- 时钟（Clock）
首先，将内存中的所有页面链接成一个循环队列，当缺页中断发生时，检查当前指针所指向页面的访问位，如果访问位为 0，就将该页面换出；否则将该页的访问位设置为 0，给该页面第二次的机会，移动指针继续检查。
