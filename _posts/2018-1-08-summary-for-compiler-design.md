---
layout: post
title:  "编译器设计小结"
tag:
- compiler
- C
comments: true
---

这学期代码量最大的课非编译器设计概论莫属，毕竟课程的目标就是让我们一步步写出一个简单的编译器出来。现在学期接近尾声了，终于差不多把任务完成了，我也把这个项目整理了一下，放到了Github上：

https://github.com/controny/compiler-for-P

整个编译器的架构如下：

![](https://raw.githubusercontent.com/controny/compiler-for-P/master/docs/skeleton.png)

我们编译的是自定义的P语言（可以看作是简化版的Pascal），编译过程如下：

1. 利用lex进行语汇分析；
2. 利用yacc进行语法分析、语义分析并生成java的bytecode；
3. 用java的Jasmin工具包把结果转成可用java虚拟机执行的class文件

因为有了这些工具的帮助，项目的构建过程比我从前想象的简单了不少。因为lex和yacc实际上可以看成一种C的框架，像是“编译器的编译器”，所以，写这个编译器和写C并没有太大的区别，这不得不让人由衷感谢开发了这些工具的大神们。

虽然我的编译器实现了课程要求的大部分功能，但我自知它还是存在不少缺陷。我暗自反省了一番，认为这主要跟我编程能力不足有关。这个项目的代码量是上千的，但由于缺乏一种编程的大局观，我没有很好地对代码进行分层次处理，遇到bug也往往采取“投机取巧”式的打补丁法来解决，导致了代码的混乱，最终的恶果就体现在程序各种无端的崩溃上。
